"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[244],{3905:function(t,e,a){a.d(e,{Zo:function(){return h},kt:function(){return k}});var n=a(7294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function c(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function s(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},c=Object.keys(t);for(n=0;n<c.length;n++)a=c[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(n=0;n<c.length;n++)a=c[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var i=n.createContext({}),l=function(t){var e=n.useContext(i),a=e;return t&&(a="function"==typeof t?t(e):o(o({},e),t)),a},h=function(t){var e=l(t.components);return n.createElement(i.Provider,{value:e},t.children)},p="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},d=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,c=t.originalType,i=t.parentName,h=s(t,["components","mdxType","originalType","parentName"]),p=l(a),d=r,k=p["".concat(i,".").concat(d)]||p[d]||u[d]||c;return a?n.createElement(k,o(o({ref:e},h),{},{components:a})):n.createElement(k,o({ref:e},h))}));function k(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var c=a.length,o=new Array(c);o[0]=d;var s={};for(var i in e)hasOwnProperty.call(e,i)&&(s[i]=e[i]);s.originalType=t,s[p]="string"==typeof t?t:r,o[1]=s;for(var l=2;l<c;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},1843:function(t,e,a){a.r(e),a.d(e,{assets:function(){return p},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return i},metadata:function(){return h},toc:function(){return u}});var n=a(7462),r=a(3366),c=(a(7294),a(3905)),o=a(4996),s=["components"],i={title:"Contract Hash vs. Package Hash"},l="Using the Contract Hash vs. the Package Hash",h={unversionedId:"developers/writing-onchain-code/contract-hash-vs-package-hash",id:"developers/writing-onchain-code/contract-hash-vs-package-hash",title:"Contract Hash vs. Package Hash",description:"This page describes the possibilities of using the contract hash vs. the contract package hash (package hash for short) when calling a contract or managing calls from other contracts. Contracts can allow, block, or track calls from other contracts. As noted in Upgrading and Maintaining Smart Contracts, the contract package contains various contract versions. The contract hash is a BLAKE2b hash of a contract, and the contract package hash is the BLAKE2b hash of a contract package.",source:"@site/source/docs/casper/developers/writing-onchain-code/contract-hash-vs-package-hash.md",sourceDirName:"developers/writing-onchain-code",slug:"/developers/writing-onchain-code/contract-hash-vs-package-hash",permalink:"/developers/writing-onchain-code/contract-hash-vs-package-hash",draft:!1,editUrl:"https://github.com/casper-network/docs/tree/dev/source/docs/casper/developers/writing-onchain-code/contract-hash-vs-package-hash.md",tags:[],version:"current",lastUpdatedAt:1721222364,formattedLastUpdatedAt:"Jul 17, 2024",frontMatter:{title:"Contract Hash vs. Package Hash"},sidebar:"developers",previous:{title:"Testing Session Code",permalink:"/developers/writing-onchain-code/testing-session-code"},next:{title:"Best Practices for Casper Smart Contract Authors",permalink:"/developers/writing-onchain-code/best-practices"}},p={},u=[{value:"The Casper Call Stack",id:"the-casper-call-stack",level:2},{value:"Recommendations",id:"recommendations",level:2},{value:"What&#39;s Next?",id:"whats-next",level:2}],d={toc:u},k="wrapper";function m(t){var e=t.components,a=(0,r.Z)(t,s);return(0,c.kt)(k,(0,n.Z)({},d,a,{components:e,mdxType:"MDXLayout"}),(0,c.kt)("h1",{id:"using-the-contract-hash-vs-the-package-hash"},"Using the Contract Hash vs. the Package Hash"),(0,c.kt)("p",null,"This page describes the possibilities of using the ",(0,c.kt)("a",{parentName:"p",href:"https://docs.rs/casper-types/3.0.0/casper_types/contracts/struct.ContractHash.html"},"contract hash")," vs. the ",(0,c.kt)("a",{parentName:"p",href:"https://docs.rs/casper-types/3.0.0/casper_types/contracts/struct.ContractPackageHash.html"},"contract package hash")," (package hash for short) when calling a contract or managing calls from other contracts. Contracts can allow, block, or track calls from other contracts. As noted in ",(0,c.kt)("a",{parentName:"p",href:"/developers/writing-onchain-code/upgrading-contracts#the-contract-package"},"Upgrading and Maintaining Smart Contracts"),", the contract package contains various contract versions. The contract hash is a BLAKE2b hash of a contract, and the contract package hash is the BLAKE2b hash of a contract package."),(0,c.kt)("p",{align:"center"},(0,c.kt)("img",{src:(0,o.Z)("/image/package-representation-extended.png"),alt:"package-representation",width:"400"})),(0,c.kt)("p",null,"Depending on what a contract needs to accomplish, it may save and manage the contract hash, package hash, or both. This behavior depends on what the contract needs to do, so a given contract might:"),(0,c.kt)("ul",null,(0,c.kt)("li",{parentName:"ul"},"Want to identify specific versions of contracts within the same package and thus use a contract hash"),(0,c.kt)("li",{parentName:"ul"},"Not need specific contract versions and allow or block all versions in the same package, thus using the contract package hash"),(0,c.kt)("li",{parentName:"ul"},"Need specific contract versions within the same package, and thus use both contract hash and contract package hash"),(0,c.kt)("li",{parentName:"ul"},"Not need either hash for this use case")),(0,c.kt)("p",null,"A given contract, i.e., CEP-18, which wants to allow or block or track calls from other contracts, should then decide:"),(0,c.kt)("ul",null,(0,c.kt)("li",{parentName:"ul"},"Will the contract allow, block, or track contract callers loosely at the package level?"),(0,c.kt)("li",{parentName:"ul"},"Will the contract allow, block, or track contract callers specifically at the contract level?")),(0,c.kt)("p",null,"Or a more fine-grained variation would be:"),(0,c.kt)("ul",null,(0,c.kt)("li",{parentName:"ul"},"Will the contract allow or block callers at the package level but track by both package and contract hash?"),(0,c.kt)("li",{parentName:"ul"},"Will the contract allow other combinations of these basic concepts?")),(0,c.kt)("p",null,"Each contract is responsible for documenting its choices and what it requires of its callers. It is essential to keep in mind the difference between the behavior of the Casper execution engine (the host), as exposed by the ",(0,c.kt)("a",{parentName:"p",href:"https://docs.rs/casper-contract/latest/casper_contract/ext_ffi/"},"Casper External FFI"),", versus use cases and interactions between two or more ecosystem entities such as accounts and contracts."),(0,c.kt)("p",null,"The execution engine doesn't know how a contract such as CEP-18 is trying to manage its internal data or its exposed functionality. The contract is responsible for creating and managing a sub-ledger of resource management, access control, etc."),(0,c.kt)("h2",{id:"the-casper-call-stack"},"The Casper Call Stack"),(0,c.kt)("p",null,"When identifying who called a contract or initiated a call chain, the execution engine offers the FFI method ",(0,c.kt)("a",{parentName:"p",href:"https://docs.rs/casper-contract/latest/casper_contract/ext_ffi/fn.casper_load_call_stack.html"},"casper_load_call_stack"),", which provides a stack of one or more entries of this kind:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-rust"},"/// Represents the origin of a sub-call.\n#[derive(Clone, Debug, PartialEq, Eq)]\npub enum CallStackElement {\n    /// Session\n    Session {\n        /// The account hash of the caller\n        account_hash: AccountHash,\n    },\n    /// Effectively an EntryPointType::Session - stored access to a session.\n    StoredSession {\n        /// The account hash of the caller\n        account_hash: AccountHash,\n        /// The contract package hash\n        contract_package_hash: ContractPackageHash,\n        /// The contract hash\n        contract_hash: ContractHash,\n    },\n    /// contract\n    StoredContract {\n        /// The contract package hash\n        contract_package_hash: ContractPackageHash,\n        /// The contract hash\n        contract_hash: ContractHash,\n    },\n}\n")),(0,c.kt)("p",null,"You can find the source code ",(0,c.kt)("a",{parentName:"p",href:"https://github.com/casper-network/casper-node/blob/release-1.5.1/types/src/system/call_stack_element.rs"},"here"),"."),(0,c.kt)("p",null,"After retrieving the required information, the contract must manage its internal logic and data storage, actions entirely opaque to the execution engine."),(0,c.kt)("p",null,"Learn more about ",(0,c.kt)("a",{parentName:"p",href:"/concepts/callstack"},"Call Stacks")," and how Casper manages the calling of a contract."),(0,c.kt)("h2",{id:"recommendations"},"Recommendations"),(0,c.kt)("p",null,"Consider the following questions when designing the contract and choosing whether to use the contract hash or package hash."),(0,c.kt)("ol",null,(0,c.kt)("li",{parentName:"ol"},(0,c.kt)("p",{parentName:"li"},"Will you allow only accounts to use the contract? If so, what kind of accounts are you considering?"),(0,c.kt)("table",{parentName:"li"},(0,c.kt)("thead",{parentName:"table"},(0,c.kt)("tr",{parentName:"thead"},(0,c.kt)("th",{parentName:"tr",align:null},"Answer"),(0,c.kt)("th",{parentName:"tr",align:null},"Recommendation"))),(0,c.kt)("tbody",{parentName:"table"},(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Specific accounts"),(0,c.kt)("td",{parentName:"tr",align:null},"Use the account hash to identify and track each account.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Exactly one specific account"),(0,c.kt)("td",{parentName:"tr",align:null},"Use the account hash of a specific account to identify it.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Any accounts"),(0,c.kt)("td",{parentName:"tr",align:null},"There is no need to track the accounts by account hash."))))),(0,c.kt)("li",{parentName:"ol"},(0,c.kt)("p",{parentName:"li"},"Will you allow only contracts to use it? If so, what kind of contracts?"),(0,c.kt)("table",{parentName:"li"},(0,c.kt)("thead",{parentName:"table"},(0,c.kt)("tr",{parentName:"thead"},(0,c.kt)("th",{parentName:"tr",align:null},"Answer"),(0,c.kt)("th",{parentName:"tr",align:null},"Recommendation"))),(0,c.kt)("tbody",{parentName:"table"},(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Specific contract versions"),(0,c.kt)("td",{parentName:"tr",align:null},"Use the contract hash to identify each contract version.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Specific contract versions of specific packages"),(0,c.kt)("td",{parentName:"tr",align:null},"Use the contract hash and the package hash to identify each contract version.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Any contract versions of specific packages"),(0,c.kt)("td",{parentName:"tr",align:null},"Use only the package hash to identify each contract package.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Any contract version of any contract"),(0,c.kt)("td",{parentName:"tr",align:null},"There is no need to track by contract or package hash."))))),(0,c.kt)("li",{parentName:"ol"},(0,c.kt)("p",{parentName:"li"},"Will you allow both accounts and contracts to use it? If so, will these accounts and contracts be:"),(0,c.kt)("table",{parentName:"li"},(0,c.kt)("thead",{parentName:"table"},(0,c.kt)("tr",{parentName:"thead"},(0,c.kt)("th",{parentName:"tr",align:null},"Answer"),(0,c.kt)("th",{parentName:"tr",align:null},"Recommendation"))),(0,c.kt)("tbody",{parentName:"table"},(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Specific accounts and contract versions"),(0,c.kt)("td",{parentName:"tr",align:null},"Use the account hash to track each account and the contract hash to identify each contract version.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Specific accounts and specific versions of specific packages"),(0,c.kt)("td",{parentName:"tr",align:null},"Use the account hash to identify each account and the contract hash and package hash to identify each contract version.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Specific accounts and any versions of specific packages"),(0,c.kt)("td",{parentName:"tr",align:null},"Use the account hash to identify each account and the package hash to identify each contract package.")),(0,c.kt)("tr",{parentName:"tbody"},(0,c.kt)("td",{parentName:"tr",align:null},"Any accounts and contracts"),(0,c.kt)("td",{parentName:"tr",align:null},"There is no need to track by account hash or contract hash.")))))),(0,c.kt)("h2",{id:"whats-next"},"What's Next?"),(0,c.kt)("ul",null,(0,c.kt)("li",{parentName:"ul"},(0,c.kt)("a",{parentName:"li",href:"/developers/writing-onchain-code/best-practices"},"Best Practices for Casper Smart Contract Authors")," - An outline of best practices when developing smart contracts on a Casper network"),(0,c.kt)("li",{parentName:"ul"},(0,c.kt)("a",{parentName:"li",href:"/resources/tutorials/advanced/cross-contract"},"Cross-Contract Communication")," - Variations of cross-contract communication for more complex scenarios"),(0,c.kt)("li",{parentName:"ul"},(0,c.kt)("a",{parentName:"li",href:"/resources/tutorials/advanced/return-values-tutorial"},"Interacting with Runtime Return Values")," - Contract code returning a value to the immediate caller via ",(0,c.kt)("inlineCode",{parentName:"li"},"runtime::ret()"))))}m.isMDXComponent=!0}}]);